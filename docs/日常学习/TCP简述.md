---
title: TCP简述
tags:
  - 技术
createTime: 2024/01/28
permalink: /article/y3gxn62l/
---
## 网络分层



最早的OSI七层模型，教学用的五层模型，实际使用的TCP/IP四层模型：网络接口层（电信号转换为二进制数据）、网络层（IP、ARP，寻找目标位置，提供尽最大努力交付，不可靠传输）、传输层（TCP、UDP，可靠传输和不可靠传输）、应用层（HTTP、FTP、DNS，给具体软件使用）。



TCP/IP协议不仅仅指的是TCP和IP两个协议，⽽是指的⼀个由`FTP,SMTP,TCP,UDP,IP,ARP`等等协议构成的**协议集合**。



## Socket



在网络中采用发送方和接收方的套接字组合来识别端点，套接字唯一标识了网络中的一个主机和它上的一个进程。



套接字（Socket）=（主机IP地址，端口号）

IP可以让我们知道目标机器位置，端口号可以让我知道具体是哪个进程或者说哪个软件使用的数据。



## TCP协议



面向连接（虚连接），可靠传输，无差错、不丢失、不重复、按序到达。可靠有序，不丢不重。



TCP提供全双工通信。

发送缓存：准备发送的数据&已发送但尚未收到确认的数据。

接收缓存：按序到达但尚未被接受应用程序读取的数据&不按序到达的数据。



TCP把应用程序交下来的数据看成仅仅是一连串的无结构的字节流。再把数据加上TCP头部，包括端口信息、序号、确认号等等校验信息，传给下层的IP协议。



### 面向连接

#### 三次握手

客户端连接请求、服务端确认连接请求、客户端确认收到确认。

#### 四次挥手

客户端告知连接释放、服务器确认收到、服务器告知连接释放、客户端告知收到。



### TCP数据包

以太网数据包（packet）的大小是固定的，而且每一层协议都有自己的头部信息，所以再减去预留给每层协议的大小，每个TCP数据包其实是很小的。

- 给数据包编号，第一个包编号随机，假设第一个是100，第二个就是101。
- 收到 TCP 数据包以后，组装还原是操作系统完成的，组装好了通过端口交给上层协议继续处理。



### 可靠传输



- 头部校验，是不是TCP数据
- 序号，这是第几个数据包
- 确认与重传，收到就确认，没收到就告知要重传



### 流量控制



目的是让发送方慢点，要让接收方来得及接收。

TCP利用**滑动窗口机制**实现流量控制。

在通信过程中，接收方根据自己接收缓存的大小，**动态地调整发送方的发送窗口大小**。



### 拥塞控制



客户端和服务端建立连接后，双方通过流量控制得到发送窗口与拥塞窗口，但是这个窗口只是针对主机与服务器的性能而决定的，整个网络的拥塞程度才决定了发送出去的数据到底能不能到达，所以可以把拥塞控制看成一个共同维护网络通畅的君子协定。



慢开始和拥塞避免：开始时发送一个数据包，收到响应后再发送两个（指数增长），当到达阈值`ssthresh`后，变为加法增长。当出现丢包的时候判断为网络拥塞，再回归到初始的一个数据包，并设置新的阈值，重复之前的操作。

快重传和快恢复：快重传与快恢复是针对上面方法的升级版，区别就是当出现网络拥塞时恢复到新的阈值水平加法增长，而不是初始值。