---
title: 浏览器请求优先级与 HTTP 2.0
tags:
 - 面试
 - 浏览器
 - 网络
createTime: 2022/02/14
permalink: /article/1g8fua6e/
---
# 浏览器请求优先级与 HTTP 2.0

***摘抄自《Web性能权威指南》-12.3.4***

浏览器在渲染页面时，并非所有资源都具有相同的优先级:HTML 文档本身对构建 DOM 不可或缺，CSS 对构建 CSSOM 不可或缺，而 DOM 和 CSSOM 的构建都可能受到 JavaScript 资源的阻塞(参见 10.1 节的附注栏“DOM、CSSOM 和 JavaScript”)，其他资源(如图片)的优先级都可以降低。

为加快页面加载速度，所有**现代浏览器都会基于资源的类型以及它在页面中的位置排定请求的优先次序，甚至通过之前的访问来学习优先级模式——比如，之前 的渲染如果被某些资源阻塞了，那么同样的资源在下一次访问时可能就会被赋予更高的优先级。**

在 HTTP 1.x 中，浏览器极少能利用上述优先级信息，因为协议本身并不支持多路复用，也没有办法向服务器通告请求的优先级。此时，浏览器只能依赖并行连接， 且最多只能同时向一个域名发送 6 个请求。于是，在等连接可用期间，请求只能 在客户端排队，从而增加了不必要的网络延迟。理论上，HTTP 管道可以解决这 个问题，只是由于缺乏支持而无法付诸实践。

HTTP 2.0 一举解决了所有这些低效的问题:浏览器可以在发现资源时立即分派请 求，指定每个流的优先级，让服务器决定最优的响应次序。这样请求就不必排队 了，既节省了时间，也最大限度地利用了每个连接。



HTTP 2.0 没有规定处理优先级的具体算法，只是提供了一种赋予数据优先级的机 制，而且要求客户端与服务器必须能够交换这些数据。这样一来，优先值作为提示 信息，对应的次序排定策略可能因客户端或服务器的实现而不同:客户端应该明确 指定优先值，服务器应该根据该值处理和交付数据。

在这个规定之下，尽管你可能无法控制客户端发送的优先值，但或许你可以控制服 务器。因此，在选择 HTTP 2.0 服务器时，可以多留点心!为说明这一点，考虑下 面几个问题。

• 如果服务器对所有优先值视而不见怎么办? • 高优先值的流一定优先处理吗?
 • 是否存在不同优先级的流应该交错的情况?

如果服务器不理睬所有优先值，那么可能会导致应用响应变慢:浏览器明明在等关 键的 CSS 和 JavaScript，服务器却在发送图片，从而造成渲染阻塞。不过，规定严 格的优先级次序也可能带来次优的结果，因为这可能又会引入队首阻塞问题，即某 个高优先级的慢请求会不必要地阻塞其他资源的交付。

服务器可以而且应该交错发送不同优先级别的帧。只要可能，高优先级流都应该优先，包括分配处理资源和客户端与服务器间的带宽。不过，为了最高效地利用底层 连接，不同优先级的混合也是必需的。